name: Issue Check
on:
    issues: 
        types: opened
jobs:
    issue_check:
        runs-on: ubuntu-latest
        steps:
            - run: |
                echo "Found issue ${{ github.event.issue.number }}"
                if "${{ github.event.issue.body }}" != "" && jq empty <<< "${{ github.event.issue.body }}" 2>/dev/null
                then
                    gh issue comment ${{ github.event.issue.html_url }} --body "Found valid JSON schema"
                else
                    gh issue comment ${{ github.event.issue.html_url }} --body "Found invalid JSON schema"
                    gh issue close ${{ github.event.issue.html_url }}
                    exit
                fi
                
                name=$(jq -r '.name' <<< ${{ github.event.issue.body }})
                author=$(jq -r '.author' <<< ${{ github.event.issue.body }})

                if "$name" == "null" || "$author" == "null"
                then
                    gh issue comment ${{ github.event.issue.html_url }} --body "Missing title or author"
                    gh issue close ${{ github.event.issue.html_url }}
                    exit 
                fi

                gh issue comment ${{ github.event.issue.html_url }} --body "Name: $name\nAuthor: $author"                    

env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}